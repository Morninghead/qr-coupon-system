<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>Advanced Card Template Editor</title>
    <script src="https://unpkg.com/konva@9.3.6/konva.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; margin: 0; padding: 20px; background-color: #f0f2f5; display: flex; gap: 30px; flex-wrap: wrap; }
        .editor-wrapper { display: flex; gap: 30px; width: 100%; }
        .controls { padding: 20px; background-color: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); width: 300px; height: fit-content; }
        .control-group { margin-bottom: 15px; }
        .control-group label, .control-group h3 { font-weight: 600; display: block; margin-bottom: 12px; color: #333; font-size: 1em; }
        .control-group button, .control-group input[type=file], .control-group select { width: 100%; padding: 8px; box-sizing: border-box; margin-bottom: 10px; }
        .control-group button { background-color: #6366F1; color: white; border: none; border-radius: 4px; cursor: pointer; transition: background-color 0.2s; }
        .control-group button:hover { background-color: #4f46e5; }
        .control-group button:disabled { background-color: #c7d2fe; cursor: not-allowed; }
        .remove-bg-btn { background-color: #EF4444 !important; font-size: 0.8em; padding: 4px; margin-top: -5px; }
        #export-json { background-color: #10B981; }
        #export-json:hover { background-color: #059669; }
        .history-buttons { display: flex; gap: 10px; }
        textarea { width: 100%; height: 150px; font-family: monospace; font-size: 12px; }
        .canvases { display: flex; gap: 30px; flex-wrap: wrap; }
        .canvas-container-wrapper { padding: 15px; background: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .canvas-container-wrapper.active { box-shadow: 0 2px 8px rgba(99, 102, 241, 0.5), 0 0 0 2px #6366F1; }
        .canvas-container-wrapper h2 { margin-bottom: 15px; font-size: 1.2em; color: #444; text-align: center; }
        .stage-wrapper { position: relative; cursor: pointer; padding-left: 25px; padding-top: 25px;}
        .konvajs-content { border: 1px solid #ccc; background-color: #fff; }
        .radio-group label, .checkbox-group label { display: inline-flex; align-items: center; margin-right: 15px; cursor: pointer; font-weight: normal; }
        #properties-panel { border-top: 1px solid #eee; padding-top: 15px; }
        .opacity-control, .font-size-control { display: flex; align-items: center; gap: 10px; }
        .opacity-control input[type=range] { flex-grow: 1; }
        .opacity-control input[type=number] { width: 60px; }
        .font-size-control input[type=number] { flex-grow: 1; }
        .font-size-control button { width: 40px; padding: 4px; margin: 0; }
        .ruler { position: absolute; background-color: #f8f8f8; overflow: hidden; display: none; }
        .ruler.horizontal { top: 0; left: 25px; height: 25px; border-bottom: 1px solid #ccc; }
        .ruler.vertical { top: 25px; left: 0; width: 25px; border-right: 1px solid #ccc; }
    </style>
</head>
<body>
    <div class="editor-wrapper">
        <div class="controls">
            <div class="control-group">
                <h3>History</h3>
                <div class="history-buttons"><button id="undo-btn">Undo</button><button id="redo-btn">Redo</button></div>
                <small><i>Tip: Press 'Delete' key to remove item.</i></small>
            </div>
            <hr>
            <div class="control-group">
                <h3>View Options</h3>
                <div class="checkbox-group">
                    <label><input type="checkbox" id="show-rulers"> Show Rulers</label>
                    <label><input type="checkbox" id="show-hole-mark"> Show Hole Mark</label>
                </div>
            </div>
            <hr>
            <div class="control-group">
                <h3>Card Orientation</h3>
                <div class="radio-group">
                    <label><input type="radio" name="orientation" value="landscape" checked> Landscape</label>
                    <label><input type="radio" name="orientation" value="portrait"> Portrait</label>
                </div>
            </div>
            <hr>
            <div class="control-group">
                <label>Front Background</label>
                <input type="file" id="bg-front-upload" accept="image/*"><button id="remove-bg-front" class="remove-bg-btn">Remove</button>
                <div class="opacity-control">
                    <input type="range" id="bg-opacity-slider" min="0" max="1" step="0.01" value="1">
                    <input type="number" id="bg-opacity-input" min="0" max="100" value="100"> %
                </div>
                <div class="checkbox-group"><label><input type="checkbox" id="lock-background"> Lock Background</label></div>
            </div>
            <div class="control-group"><label for="bg-back-upload">Back Background</label><input type="file" id="bg-back-upload" accept="image/*"><button id="remove-bg-back" class="remove-bg-btn">Remove</button></div>
            <hr>
            <div class="control-group">
                <label>Add Elements (to Active Card)</label>
                <button id="add-photo">Add Employee Photo</button>
                <button id="add-employee-name">Add Employee Name</button>
                <button id="add-employee-id">Add Employee ID</button>
                <button id="add-company-name">Add Company Name</button>
                <button id="add-logo">Add Company Logo</button>
                <button id="add-qr">Add QR Code</button>
            </div>
            <div id="properties-panel" class="control-group" style="display: none;"></div>
            <hr>
            <div class="control-group">
                <label>Export Layout</label>
                <button id="export-json">Export Layout as JSON</button>
                <textarea id="json-output" readonly placeholder="JSON output will appear here..."></textarea>
            </div>
        </div>
        <div class="canvases">
            <div class="canvas-container-wrapper" id="front-container">
                <h2>Front</h2>
                <div class="stage-wrapper">
                    <canvas id="ruler-v-front" class="ruler vertical"></canvas><canvas id="ruler-h-front" class="ruler horizontal"></canvas>
                    <div id="stage-container-front"></div>
                </div>
            </div>
            <div class="canvas-container-wrapper" id="back-container">
                <h2>Back</h2>
                <div class="stage-wrapper">
                     <canvas id="ruler-v-back" class="ruler vertical"></canvas><canvas id="ruler-h-back" class="ruler horizontal"></canvas>
                     <div id="stage-container-back"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="card-editor.js" defer></script>
</body>
</html>